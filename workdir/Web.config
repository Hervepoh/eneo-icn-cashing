<?xml version="1.0" encoding="UTF-8"?>
<configuration>

  <appSettings>

	<add key="Requete_Impayes_Par_Numero_Contrat" value="
		select /*+ parallel(4) */
			doc_id code_regroupement,
			r.nis_rad numero_contrat,
			r.num_rec numero_facture,
			(select regexp_replace(regexp_replace(c.ape1_cli,'[\+\*\$!%,?\.;^¨§]*') || ' ' ||
			regexp_replace(c.nom_cli,'[\+\*\$!%,?\.;^¨§]*') || ' ' ||
			regexp_replace(c.ape2_cli,'[\+\*\$!%,?\.;^¨§]*'), '^[[:blank:][:space:]''\+\*\$!%,?\.;^¨§-]*|[[:blank:][:space:]''\+\*\$!%,?\./;^¨§-]*$')
			from cmsadmin.clientes c join cmsadmin.sumcon s on c.cod_cli = s.cod_cli where s.nis_rad = r.nis_rad) nom_client,
			to_char(r.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			ceil(imp_tot_rec-imp_cta) montant_impaye
		from cmsadmin.recibos r left join cmsadmin.xclientes x on r.nis_rad = x.nis_rad
			join cmsadmin.sumcon s on r.nis_rad = s.nis_rad and regexp_like(s.est_serv,'EC0(1[1-4]|2[08])')
		where r.nis_rad = :ContractNber
			and r.f_prev_puesta between to_date(:FromDate, 'dd/mm/yyyy') and to_date(:ToDate, 'dd/mm/yyyy')
			and imp_tot_rec - imp_cta > 0
			and regexp_like(tip_rec, 'TR0([1-6]0|12|21|22)')
			and ((r.est_act in (select est_rec from cmsadmin.grupo_est where co_grupo = 'GE114')
					and regexp_like(s.est_serv,'EC0(1[1-4]|28)'))
				or (r.est_act = 'ER240' and s.est_serv = 'EC020'))
		order by f_prev_puesta desc " />

	<add key="Requete_Impayes_Par_Numero_Facture" value="
		select /*+ parallel(6) */
			s.regroup_id code_regroupement,
			decode(r.nis_rad, 0, r.cod_cta_pago, r.nis_rad) numero_contrat,
			r.num_rec numero_facture,
			s.cust_name nom_client,
			to_char(r.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			ceil(imp_tot_rec-imp_cta) montant_impaye
		from cmsadmin.recibos r
			left join cmsreport.tb_customers_infos s on r.nis_rad = s.nis_rad and regexp_like(s.est_serv,'EC0(1[1-4]|2[08])')
		where /*r.num_rec in (424378539) or*/ (r.num_rec = :BillNber
			and r.imp_tot_rec - r.imp_cta > 0
			and regexp_like(r.tip_rec, 'TR0([1-6]0|12|21|22)')
			and ((r.est_act in (select est_rec from cmsadmin.grupo_est where co_grupo = 'GE114')
					and regexp_like(s.est_serv,'EC0(1[1-4]|28)'))
				or (r.est_act = 'ER240' and s.est_serv = 'EC020')
				or r.nis_rad = 0)) " />

	<add key="Requete_Impayes_Par_Code_Regroupement" value="
		with regroupCusts as (select /*+ parallel(2) */ doc_id, nis_rad from cmsadmin.xclientes x where x.doc_id = :RegroupCode)
		select /*+ parallel(4) */
			doc_id code_regroupement,
			r.nis_rad numero_contrat,
			r.num_rec numero_facture,
			(select regexp_replace(regexp_replace(c.ape1_cli,'[\+\*\$!%,?\.;^¨§]*') || ' ' ||
			regexp_replace(c.nom_cli,'[\+\*\$!%,?\.;^¨§]*') || ' ' ||
			regexp_replace(c.ape2_cli,'[\+\*\$!%,?\.;^¨§]*'), '^[[:blank:][:space:]''\+\*\$!%,?\.;^¨§-]*|[[:blank:][:space:]''\+\*\$!%,?\./;^¨§-]*$')
			from cmsadmin.clientes c join cmsadmin.sumcon s on c.cod_cli = s.cod_cli where s.nis_rad = r.nis_rad) nom_client,
			to_char(r.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			ceil(imp_tot_rec-imp_cta) montant_impaye
		from cmsadmin.recibos r join regroupCusts x on r.nis_rad = x.nis_rad
			join cmsadmin.sumcon s on r.nis_rad = s.nis_rad and regexp_like(s.est_serv,'EC0(1[1-4]|2[08])')
		where imp_tot_rec - imp_cta > 0
			and r.f_prev_puesta between to_date(:FromDate, 'dd/mm/yyyy') and to_date(:ToDate, 'dd/mm/yyyy')
			and regexp_like(tip_rec, 'TR0([1-6]0|12|21|22)')
			and ((r.est_act in (select est_rec from cmsadmin.grupo_est where co_grupo = 'GE114')
					and regexp_like(s.est_serv,'EC0(1[1-4]|28)'))
				or (r.est_act = 'ER240' and s.est_serv = 'EC020'))
		order by f_prev_puesta desc " />

	<add key="Requete_Impayes_Par_Nom_Client" value="
		with tb_sdgc_groupes as (select /*+ parallel(2) */ groupe, service_no from cmsadmin.sdgc_groupes x where groupe = :CustomerName)
		select /*+ parallel(4) */
			groupe code_regroupement,
			r.nis_rad numero_contrat,
			r.num_rec numero_facture,
			(select regexp_replace(regexp_replace(c.ape1_cli,'[\+\*\$!%,?\.;^¨§]*') || ' ' || regexp_replace(c.nom_cli,'[\+\*\$!%,?\.;^¨§]*') || ' ' ||
				regexp_replace(c.ape2_cli,'[\+\*\$!%,?\.;^¨§]*'), '^[[:blank:][:space:]''\+\*\$!%,?\.;^¨§-]*|[[:blank:][:space:]''\+\*\$!%,?\./;^¨§-]*$')
				from cmsadmin.clientes c join cmsadmin.sumcon s on c.cod_cli = s.cod_cli where s.nis_rad = r.nis_rad) nom_client,
			to_char(r.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			ceil(imp_tot_rec-imp_cta) montant_impaye
		from cmsadmin.recibos r join tb_sdgc_groupes x on r.nis_rad = x.service_no
			join cmsadmin.sumcon s on r.nis_rad = s.nis_rad and regexp_like(s.est_serv,'EC0(1[1-4]|2[08])')
		where imp_tot_rec - imp_cta > 0
			and r.f_prev_puesta between to_date(:FromDate, 'dd/mm/yyyy') and to_date(:ToDate, 'dd/mm/yyyy')
			and regexp_like(tip_rec, 'TR0([1-6]0|12|21|22)')
			and ((r.est_act in (select est_rec from cmsadmin.grupo_est where co_grupo = 'GE114')
					and regexp_like(s.est_serv,'EC0(1[1-4]|28)'))
				or (r.est_act = 'ER240' and s.est_serv = 'EC020'))
			order by f_prev_puesta desc " />

	<add key="Requete_Impayes_Sur_Liste" value="
		select /*+ parallel(8) */ distinct
			(select distinct s.groupe from cmsadmin.sdgc_groupes s where s.service_no = b.nis_rad) code_regroupement,
			b.nis_rad numero_contrat,
			b.num_rec numero_facture,
			(select regexp_replace(regexp_replace(regexp_replace(c.ape1_cli || ' ' || c.nom_cli || ' ' || c.ape2_cli,'[\+\*\$!%,?;^¨§]*'),
				'^[[:blank:][:space:]''\+\*\$!%,?;^¨§-]*|[[:blank:][:space:]''\+\*\$!%,?/;^¨§-]*$'),'[[:blank:][:space:]]{2,}', ' ')
				from cmsadmin.clientes c where c.cod_cli = s.cod_cli) nom_client,
			to_char(c.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			b.paid_amount montant_paye,
			nvl(c.imp_tot_rec-c.imp_cta, 0) montant_impaye,
			(case  /*-- L'ordre des Tests ci-dessous est HYPER Important !!! --*/
				when s.nis_rad is null and r.num_rec is null then 'BAD SERVICE &amp; BAD BILL'
				when s.nis_rad is null then 'BAD SERVICE'
				when r.num_rec is null then 'BAD BILL'
				when c.num_rec is null then 'BAD LINK'
				when c.imp_tot_rec - c.imp_cta &lt;= 0 then 'PAID'
				when not regexp_like(r.tip_rec, 'TR0([1-6]0|12|21|22)') then 'INCORRECT BILL TYPE'
				when regexp_like(s.est_serv,'EC0(1[1-4]|28)') and c.est_act not in (select 'ER315' from dual union select g.est_rec from cmsadmin.grupo_est g where g.co_grupo = 'GE114') then 'INCORRECT BILL STATUS'
				when s.est_serv = 'EC020' and c.est_act = 'ER240' then 'OK'
				when not regexp_like(s.est_serv,'EC0(1[1-4]|28)') and c.est_act in (select g.est_rec from cmsadmin.grupo_est g where g.co_grupo = 'GE114') then 'INCORRECT SERVICE STATUS'
				when s.est_serv = 'EC020' and c.est_act &lt;&gt; 'ER240' then 'INACTIVE SERVICE'
				else 'OK'
			end) result
		from bills_to_pay b
			left join cmsadmin.sumcon s on b.nis_rad = s.nis_rad
			left join cmsadmin.recibos r on b.num_rec = r.num_rec
			left join cmsadmin.recibos c on b.num_rec = c.num_rec and b.nis_rad = c.nis_rad
		where b.nis_rad &lt;&gt; 0
			and b.num_rec &lt;&gt; 0
			and r.tip_rec != 'TR060'
		union
		select /*+ parallel(8) */ distinct
			(select distinct s.groupe from cmsadmin.sdgc_groupes s where s.service_no = b.nis_rad) code_regroupement,
			b.nis_rad numero_contrat,
			b.num_rec numero_facture,
			(select regexp_replace(regexp_replace(regexp_replace(c.ape1_cli || ' ' || c.nom_cli || ' ' || c.ape2_cli,'[\+\*\$!%,?;^¨§]*'),
				'^[[:blank:][:space:]''\+\*\$!%,?;^¨§-]*|[[:blank:][:space:]''\+\*\$!%,?/;^¨§-]*$'),'[[:blank:][:space:]]{2,}', ' ')
				from cmsadmin.clientes c where c.cod_cli = s.cod_cli) nom_client,
			to_char(r.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			b.paid_amount montant_paye,
			nvl(r.imp_tot_rec-r.imp_cta, 0) montant_impaye,
			(case  /*-- L'ordre des Tests ci-dessous est HYPER Important !!! --*/
				when s.nis_rad is null and r.num_rec is null then 'BAD SERVICE - BAD BILL'
				when s.nis_rad is null then 'BAD SERVICE'
				when cu.num_rec_cuota is null then 'BAD BILL'
				when m.num_rec is null then 'BAD LINK'
				when sb.nis_rad is null or b.nis_rad != sb.nis_rad then 'BAD LINK'
				when r.imp_tot_rec - r.imp_cta &lt;= 0 then 'PAID'
				when r.tip_rec &lt;&gt; 'TR060' then 'INCORRECT BILL TYPE'
				when regexp_like(s.est_serv,'EC0(1[1-4]|28)') and r.est_act not in (select 'ER315' from dual union select g.est_rec from cmsadmin.grupo_est g where g.co_grupo = 'GE114') then 'INCORRECT BILL STATUS'
				when s.est_serv = 'EC020' and r.est_act = 'ER240' then 'OK'
				when not regexp_like(s.est_serv,'EC0(1[1-4]|28)') and r.est_act in (select g.est_rec from cmsadmin.grupo_est g where g.co_grupo = 'GE114') then 'INCORRECT SERVICE STATUS'
				when s.est_serv = 'EC020' and (r.est_act &lt;&gt; 'ER240' or sb.est_act &lt;&gt; 'ER240') then 'INACTIVE SERVICE'
				else 'OK'
			end) result
		from bills_to_pay b
			join cmsadmin.recibos r on b.num_rec = r.num_rec
			join cmsadmin.cuotas cu on b.num_rec = cu.num_rec_cuota
			join cmsadmin.macuerdos_rec m on cu.id_acuerdo = m.id_acuerdo
			join cmsadmin.recibos sb on m.num_rec = sb.num_rec
			join cmsadmin.sumcon s on sb.nis_rad = s.nis_rad
		where b.nis_rad &lt;&gt; 0
			and b.num_rec &lt;&gt; 0
			and r.tip_rec = 'TR060' " />

	<add key="Requete_Impayes_Sur_Liste_Avec_Compte" value="
		select /*+ parallel(8) */ distinct
			(select distinct s.groupe from cmsadmin.sdgc_groupes s where s.service_no = b.nis_rad) code_regroupement,
			b.nis_rad numero_contrat,
			b.num_rec numero_facture,
			(select regexp_replace(regexp_replace(regexp_replace(c.ape1_cli || ' ' || c.nom_cli || ' ' || c.ape2_cli,'[\+\*\$!%,?;^¨§]*'),
				'^[[:blank:][:space:]''\+\*\$!%,?;^¨§-]*|[[:blank:][:space:]''\+\*\$!%,?/;^¨§-]*$'),'[[:blank:][:space:]]{2,}', ' ')
				from cmsadmin.clientes c where c.cod_cli = s.cod_cli) nom_client,
			to_char(c.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			b.paid_amount montant_paye,
			nvl(c.imp_tot_rec-c.imp_cta, 0) montant_impaye,
			(case  /*-- L'ordre des Tests ci-dessous est HYPER Important !!! --*/
				when s.nis_rad is null and r.num_rec is null then 'BAD SERVICE &amp; BAD BILL'
				when s.nis_rad is null then 'BAD SERVICE'
				when r.num_rec is null then 'BAD BILL'
				when c.num_rec is null then 'BAD LINK'
				when c.imp_tot_rec - c.imp_cta &lt;= 0 then 'PAID'
				when not regexp_like(r.tip_rec, 'TR0([1-6]0|12|21|22)') then 'INCORRECT BILL TYPE'
				when regexp_like(s.est_serv,'EC0(1[1-4]|28)') and c.est_act not in (select 'ER315' from dual union select g.est_rec from cmsadmin.grupo_est g where g.co_grupo = 'GE114') then 'INCORRECT BILL STATUS'
				when s.est_serv = 'EC020' and c.est_act = 'ER240' then 'OK'
				when not regexp_like(s.est_serv,'EC0(1[1-4]|28)') and c.est_act in (select g.est_rec from cmsadmin.grupo_est g where g.co_grupo = 'GE114') then 'INCORRECT SERVICE STATUS'
				when s.est_serv = 'EC020' and c.est_act &lt;&gt; 'ER240' then 'INACTIVE SERVICE'
				else 'OK'
			end) result
		from bills_to_pay b
			left join cmsadmin.sumcon s on b.nis_rad = s.nis_rad
			left join cmsadmin.recibos r on b.num_rec = r.num_rec
			left join cmsadmin.recibos c on b.num_rec = c.num_rec and b.nis_rad = c.nis_rad
		where b.nis_rad &lt;&gt; 0
			and b.num_rec &lt;&gt; 0
		union
		select /*+ parallel(8) */ distinct
			'' code_regroupement,
			c.cod_cta_pago numero_contrat,
			b.num_rec numero_facture,
			(select regexp_replace(regexp_replace(regexp_replace(c.ape1_cli || ' ' || c.nom_cli || ' ' || c.ape2_cli,'[\+\*\$!%,?;^¨§]*'),
				'^[[:blank:][:space:]''\+\*\$!%,?;^¨§-]*|[[:blank:][:space:]''\+\*\$!%,?/;^¨§-]*$'),'[[:blank:][:space:]]{2,}', ' ')
				from cmsadmin.clientes c join cmsadmin.expedientes e on c.cod_cli = e.cod_cli_s where e.num_exp = r.num_fact) nom_client,
			to_char(c.f_prev_puesta,'dd/mm/yyyy') date_facturation,
			b.paid_amount montant_paye,
			nvl(c.imp_tot_rec-c.imp_cta, 0) montant_impaye,
			(case  /*-- L'ordre des Tests ci-dessous est HYPER Important !!! --*/
				when r.num_rec is null then 'BAD BILL'
				when c.num_rec is null then 'BAD LINK'
				when c.imp_tot_rec - c.imp_cta &lt;= 0 then 'PAID'
				when not regexp_like(r.tip_rec, 'TR0([1-6]0|12|21|22)') then 'INCORRECT BILL TYPE'
				when c.est_act not in (select 'ER315' from dual union select g.est_rec from cmsadmin.grupo_est g where g.co_grupo = 'GE114') then 'INCORRECT BILL STATUS'
				else 'OK'
			end) result
		from bills_to_pay b
			left join cmsadmin.recibos r on b.num_rec = r.num_rec
			left join cmsadmin.recibos c on b.num_rec = c.num_rec and b.cod_cta = c.cod_cta_pago
		where b.cod_cta &lt;&gt; 0
			and b.nis_rad = 0
			and b.num_rec &lt;&gt; 0 " />

	<add key="Requete_Selection_Code_ACI" value="select cmsadmin.seq_code_aci.nextval codeaci from dual" />

	<add key="Requete_Selection_Code_Dematerialisation" value="select cmsadmin.seq_code_dematerialisation.nextval code_dematerialisation from dual" />

	<add key="Requete_Selection_Groupes" value="select distinct trim(groupe) groupe from cmsadmin.sdgc_groupes order by 1" />

    <add key="Requete_Infos_ACI" value="
		select * from (
		select /*+ parallel(c 6) parallel(g 2) */ distinct
			(case
				when not regexp_like(c.datos_pago,'@ACI') and not regexp_like(c.datos_pago,'@FP004@') then ''
				when regexp_like(c.datos_pago,'@ACI No:[0-9]+@') then regexp_replace(c.datos_pago,'.+@ACI No:([0-9]+)@.+', '\1')
				when regexp_like(c.datos_pago,'@ACI No:[0-9]+\.00@') then regexp_replace(c.datos_pago,'.+@ACI No:([0-9]+)\.00@.+', '\1')
				when regexp_like(c.datos_pago,'@ACI No:[\.0-9]+E[0-9]@') then regexp_replace(c.datos_pago,'.+@ACI No:([0-9])\.([0-9]+)E[0-9]@.+', '\1\2')
				else regexp_replace(c.comentarios_cli,'\(From external agencies\)@BP([0-9]+)\..+', '\1')
			end) aci_number,
			g.num_recibos as number_of_payments,
			g.imp_credito as paid_amount
		from cmsadmin.cobtemp c
			join cmsadmin.gestiones_cobro g on c.num_gest_cobro = g.num_gest_cobro
		where c.cod_caja = 5701473
			and (regexp_like(c.datos_pago,:Aci_Number) or regexp_like(c.comentarios_cli,:Aci_Number))
			and (c.est_cobtemp = 'OS005' or c.id_pago &lt;&gt; 0)
		)
		where aci_number = :Aci_Number" />

    <add key="___Requete_Selection_ACI_Infos_Light" value="
        select /*+ parallel(6) */ distinct
          id_cobtemp,
          session_id,
          id_pago,
          nis_rad,
          bill_number,
          customer_name,
          billing_date,
          bill_type,
          voltage_type,
          method_of_payment,
          transaction_id,
          paid_amount,
          real_bill_amount,
          error_code,
          error_description,
          collected_amt_without_tax,
          collected_vat,
          collected_amt_with_tax,
          advance_payment,
          aci_number,
          cash_box,
          upload_date,
          count(distinct id_cobtemp) over() Number_Of_Bills,
          sum(paid_amount) over() Total_Amount_Paid
        from (
        select /*+ parallel(12) */ distinct
            c.id_cobtemp,
            g.num_gest_cobro session_id,
            c.id_pago,
            r.nis_rad,
            c.cob_fuente_id bill_number,

            s.cust_name customer_name,
			/**--(regexp_replace(translate(
            --  regexp_replace(cl.ape1_cli || ' ' || cl.ape2_cli || ' ' || cl.nom_cli, '^[[:cntrl:][:space:]]+', ' '), '{}[]$¨%¤£§^','()()-----'),' ?.$')
            --) customer_name,*/

            to_char(r.f_fact, 'dd/mm/yyyy') billing_date,
            tipo(r.tip_rec) bill_type,
            /**--tipo(sm.tip_tension) voltage_type,*/
            tipo(s.tip_tension) voltage_type,
            tipo (c.tip_forma_pago) method_of_payment,
            replace(substr(c.datos_pago, 18, 20),'@') transaction_id,
            c.imp_cob_bco paid_amount,
            r.imp_tot_rec real_bill_amount,

            ce.co_error as error_code,
            codigo(ce.co_error) as error_description,

            (select sum(imp_movcaja) from cmsadmin.movcaja_conc mc where mc.num_rec = c.cob_fuente_id and mc.pago_id = c.id_pago and mc.usuario = g.usuario and mc.co_concepto not like 'CT%') as collected_amt_without_tax,
            (select sum(imp_movcaja) from cmsadmin.movcaja_conc mc where mc.num_rec = c.cob_fuente_id and mc.pago_id = c.id_pago and mc.usuario = g.usuario and mc.co_concepto like 'CT%') as collected_vat,
            (select sum(imp_movcaja) from cmsadmin.movcaja_conc mc where mc.num_rec = c.cob_fuente_id and mc.pago_id = c.id_pago and mc.usuario = g.usuario) as collected_amt_with_tax,

            (select /*+ parallel(re 2) parallel(mo 2) */ re.imp_tot_rec
                from cmsadmin.recibos re
                    join cmsadmin.movcaja mo on re.num_rec = mo.num_rec
                where re.nis_rad = s.nis_rad
                    and mo.pago_id = c.id_pago
                    and re.est_act = 'ER310'
                    and re.tip_rec = 'TR071'
                    and c.imp_cob_bco &gt;= re.imp_tot_rec) advance_payment,

            (case
				when not regexp_like(c.datos_pago,'@ACI') and not regexp_like(c.datos_pago,'@FP004@') then ''
				when regexp_like(c.datos_pago,'@ACI No:[0-9]+@') then regexp_replace(c.datos_pago,'.+@ACI No:([0-9]+)@.+', '\1')
				when regexp_like(c.datos_pago,'@ACI No:[0-9]+\.00@') then regexp_replace(c.datos_pago,'.+@ACI No:([0-9]+)\.00@.+', '\1')
				when regexp_like(c.datos_pago,'@ACI No:[\.0-9]+E[0-9]@') then regexp_replace(c.datos_pago,'.+@ACI No:([0-9])\.([0-9]+)E[0-9]@.+', '\1\2')
				else regexp_replace(c.comentarios_cli,'\(From external agencies\)@BP([0-9]+)\..+', '\1')
            end) aci_number,
            c.cod_caja cash_box,
            to_char(g.f_actual, 'dd/mm/yyyy') upload_date
        from cmsadmin.cobtemp c
            join cmsadmin.gestiones_cobro g on c.num_gest_cobro = g.num_gest_cobro
            left outer join cmsadmin.coberror ce on c.id_cobtemp = ce.id_cobtemp and c.datos_cobro = ce.datos_cobro
            left outer join cmsadmin.recibos r on c.cob_fuente_id = r.num_rec
            left outer join cmsadmin.movcaja m on c.cob_fuente_id = m.num_rec and c.id_pago = m.pago_id and m.usuario = g.usuario
            left outer join cmsreport.tb_customers_infos s on r.nis_rad = s.nis_rad
            /**--left outer join cmsadmin.sumcon s on r.nis_rad = s.nis_rad
            --left outer join cmsadmin.clientes cl on s.cod_cli = cl.cod_cli
            --left outer join cmsadmin.suministros sm on s.num_sum = sm.num_sum*/
        where c.cod_caja in (5701473) and g.cod_caja in (5701473)
			and (regexp_like(c.datos_pago, :ACI_NUMBER) or regexp_like(c.comentarios_cli, :ACI_NUMBER))
        )
        where aci_number = to_char(:ACI_NUMBER) "/>

    <!--add key="___Requete_Selection_ACI_Infos_Light" value=" -->
    <add key="Requete_Selection_ACI_Infos" value="
		select /*+ parallel(6) */ distinct
			id_cobtemp,
			session_id,
			id_pago,
			nis_rad,
			bill_number,
			customer_name,
			billing_date,
			bill_type,
			voltage_type,
			method_of_payment,
			transaction_id,
			paid_amount,
			real_bill_amount,
			error_code,
			error_description,
			collected_amt_without_tax,
			collected_vat,
			collected_amt_with_tax,
			advance_payment,
			aci_number,
			c.cod_caja cash_box,
			upload_date,
			count(distinct id_cobtemp) over() Number_Of_Bills,
			sum(paid_amount) over() Total_Amount_Paid
		from cmsreport.tb_offline_collections c
        where aci_number = to_char(:ACI_NUMBER) "/>
		
	<add key="Requete_Informations_Tous_Les_Agents" value="
		select
			o.cso_matricule,
			o.cso_grade grade_agent,
			trim(p.std_n_fam_name_1) std_n_fam_name_1,
			trim(p.std_n_first_name) std_n_first_name,
			trim(p.std_n_first_name) || ' ' || trim(std_n_fam_name_1) all_name,
			o.cso_titre,
			o.cso_departement,
			cso_n1,
			/*(select std_email from m4prod.m4cso_don_outlook t where t.cso_matricule = o.cso_n1) cso_n1,
			nvl(n1.std_email, n2.std_email) cso_n1,*/
			nvl(cso_n2, cso_n1) cso_n2,
			/*(select std_email from m4prod.m4cso_don_outlook t where t.cso_matricule = o.cso_n2) cso_n2,
			nvl(n2.std_email, n1.std_email) cso_n2,*/
			regexp_replace(o.cso_ip_phone,'[^0-9]') ip_phone,
			regexp_replace(o.cso_gsm_phone,'[^0-9]') mobile_phone,
			(case 
				when trim(regexp_replace(o.std_email,'[[:blank:][:space:]]+')) is not null then trim(regexp_replace(o.std_email,'[[:blank:][:space:]]+'))
				when trim(regexp_replace(o.cso_login,'[[:blank:][:space:]]+')) is not null then trim(regexp_replace(o.cso_login,'[[:blank:][:space:]]+')) || '@eneo.cm'
				else ''
			end) std_email,
			o.std_n_work_locat localite
		from m4prod.m4cso_don_outlook o 
		join m4prod.std_person p on o.cso_matricule = p.std_id_person
		/*left join m4prod.m4cso_don_outlook n1 on o.cso_n1 = n1.cso_matricule
		left join m4prod.m4cso_don_outlook n2 on o.cso_n2 = n2.cso_matricule*/ " />

	<add key="Requete_Informations_Agent" value="
		select
			cso_matricule,
			o.cso_grade grade_agent,
			trim(std_n_fam_name_1) std_n_fam_name_1,
			trim(std_n_first_name) std_n_first_name,
			trim(std_n_first_name) || ' ' || trim(std_n_fam_name_1) all_name,
			cso_titre,
			cso_departement,
			cso_n1,
			cso_n2,
			std_email
		from m4prod.m4cso_don_outlook o 
		join m4prod.std_person p on o.cso_matricule = p.std_id_person
		where cso_matricule = :Matricule" />

	<add key="Requete_Informations_Famille" value="
		select
			std_id_family_pers,
			trim(std_n_fam_name_1) std_n_fam_name_1,
			trim(std_n_first_name) std_n_first_name,
			trim(std_n_first_name) || ' ' || trim(std_n_fam_name_1) all_name,
			trim(std_id_dep_type) std_id_dep_type,
			to_char(std_dt_birth,'dd/mm/yyyy') std_dt_birth
		from m4prod.std_family f
			join m4prod.std_person p on f.std_id_family_pers = p.std_id_person
		where std_id_hr = :Matricule" />

	<add key="Requete_Informations_Mission" value="
		select
			b.std_id_hr,
			trim(a.std_n_fam_name_1) std_n_fam_name_1,
			trim(a.std_n_first_name) std_n_first_name,
			trim(a.std_n_first_name) || ' ' || trim(a.std_n_fam_name_1) all_name,
			b.cso_motif_mission motif_mission,
			to_char(b.dt_start, 'dd/mm/yyyy') date_debut,
			to_char(b.dt_end, 'dd/mm/yyyy') date_fin,
			trim(c.std_n_fam_name_1) as nom_sponsor,
			trim(c.std_n_first_name) as prenom_sponsor,
			trim(c.std_n_first_name) || ' ' || trim(c.std_n_fam_name_1) all_name_sponsor,
			to_char(b.cso_dt_signatur_be, 'dd/mm/yyyy') as date_signature_sponsor,
			trim(d.std_n_fam_name_1) as nom_signataire,
			trim(d.std_n_first_name) as prenom_signature,
			trim(d.std_n_first_name) || ' ' || trim(d.std_n_fam_name_1) all_name_signataire,
			to_char(b.cso_dt_signatur_si, 'dd/mm/yyyy') as date_signature_signataire
		from m4prod.std_person a
			join m4prod.m4cso_ordre_missio b on a.std_id_person=b.std_id_hr
			join m4prod.std_person c on c.std_id_person=b.std_id_hr1
			join m4prod.std_person d on d.std_id_person=b.std_id_hr2
			join m4prod.m4cso_doc_budgtair e on b.cso_ref_om=e.cso_ref_doc
		where  /*e.cso_id_statut_om in ('7', '8', '9', '12')*/
			to_number(e.cso_id_statut_om) >= 7
			and B.cso_ref_OM = trim(replace(:Numero_OM, ' ')) " />

      <add key="Requete_Devis_Paye_Apres" value="
	    select distinct
		    mv.pago_id numero_recu,
		    r.num_rec numero_facture,
		    r.imp_tot_rec montant_paye,
		    estado(r.est_act) statut_paiement,
		    to_char(trunc(p.f_pago), 'dd/mm/yyyy') date_paiement,
		    c.cust_nombre nom_client,
		    c.pay_id numero_devis,
		    count(*) over(partition by c.pay_id) nber_of_payments,
		    row_number() over(partition by c.pay_id order by p.f_pago desc) num_order
	    from cmsadmin.movcaja mv
		    join cmsadmin.recibos r on mv.num_rec = r.num_rec
		    join cmsadmin.pagos p on p.id_pago = mv.pago_id
		    join cmsadmin.cobotro_emp c on c.pago_id = p.id_pago
	    where r.tip_rec = 'TR074'
		    and mv.imp_movcaja > 0
		    and mv.f_pago >= to_date(:Earlier_Date, 'dd/mm/yyyy') " />

    <add key="Requete_Devis_Par_Numero_Devis" value="
	    select distinct
		    mv.pago_id numero_recu,
		    r.num_rec numero_facture,
		    r.imp_tot_rec montant_paye,
		    estado(r.est_act) statut_paiement,
		    to_char(trunc(p.f_pago), 'dd/mm/yyyy') date_paiement,
		    c.cust_nombre nom_client,
		    c.pay_id numero_devis,
		    count(*) over(partition by c.pay_id) nber_of_payments,
		    row_number() over(partition by c.pay_id order by p.f_pago desc) num_order
	    from cmsadmin.movcaja mv
		    join cmsadmin.recibos r on mv.num_rec = r.num_rec
		    join cmsadmin.pagos p on p.id_pago = mv.pago_id
		    join cmsadmin.cobotro_emp c on c.pago_id = p.id_pago
	    where r.tip_rec = 'TR074'
		    and mv.imp_movcaja > 0
		    and c.pay_id = :Numero_Devis
		    and mv.f_pago >= to_date(:Earlier_Date, 'dd/mm/yyyy') " />

    <add key="Requete_Devis_Par_Numero_Recu" value="
	    select distinct
		    mv.pago_id numero_recu,
		    r.num_rec numero_facture,
		    r.imp_tot_rec montant_paye,
		    estado(r.est_act) statut_paiement,
		    to_char(trunc(p.f_pago), 'dd/mm/yyyy') date_paiement,
		    c.cust_nombre nom_client,
		    c.pay_id numero_devis,
		    count(*) over(partition by c.pay_id) nber_of_payments,
		    row_number() over(partition by c.pay_id order by p.f_pago desc) num_order
	    from cmsadmin.movcaja mv
		    join cmsadmin.recibos r on mv.num_rec = r.num_rec
		    join cmsadmin.pagos p on p.id_pago = mv.pago_id
		    join cmsadmin.cobotro_emp c on c.pago_id = p.id_pago
	    where r.tip_rec = 'TR074'
		    and mv.imp_movcaja > 0
		    and mv.pago_id = :Numero_Recu " />

    <add key="Requete_Devis_Par_Numero_Facture" value="
	    select distinct
		    mv.pago_id numero_recu,
		    r.num_rec numero_facture,
		    r.imp_tot_rec montant_paye,
		    estado(r.est_act) statut_paiement,
		    to_char(trunc(p.f_pago), 'dd/mm/yyyy') date_paiement,
		    c.cust_nombre nom_client,
		    c.pay_id numero_devis,
		    count(*) over(partition by c.pay_id) nber_of_payments,
		    row_number() over(partition by c.pay_id order by p.f_pago desc) num_order
	    from cmsadmin.movcaja mv
		    join cmsadmin.recibos r on mv.num_rec = r.num_rec
		    join cmsadmin.pagos p on p.id_pago = mv.pago_id
		    join cmsadmin.cobotro_emp c on c.pago_id = p.id_pago
	    where r.tip_rec = 'TR074'
		    and mv.imp_movcaja > 0
		    and mv.num_rec = :Numero_Facture " />

		<add key="Requete_List_Of_Tiers" value="
			select
				tt.code,
				tt.raisonsociale,
				tr.catregion
			from suite_financiere.troletiers tr
				join suite_financiere.ttiers tt on tr.oidtiers = tt.oid
			where enactivite = 1
				and tt.code like 'C%'
				and tr.catregion in ('RDRSOM','RDRONO','RDRNEA','RDRE','RDRSANO','RDRSM','RDRYDE','RDRC','RDRDLA','RDRES')
			order by tr.catregion " />

		<add key="Requete_List_Of_TiersD" value="
			select
				ts.code,
				ts.caption
			from suite_financiere.tservice ts
			order by ts.caption " />

		<add key="Requete_List_Of_Services" value="
			select
				typeproduit type_produit,
				tproduit.code,
				tproduit.caption
			from suite_financiere.tproduit, suite_financiere.tproduitcommercial
			where typeproduit = 1
				and tproduitcommercial.actif = 1
				and tproduitcommercial.oid = tproduit.oidproduitachat
			order by tproduit.caption " />

		<add key="Requete_List_Of_Tiers_Per_Region" value="
			select
				tt.code,
				tt.raisonsociale,
				tr.catregion
			from suite_financiere.troletiers tr
				join suite_financiere.ttiers tt on tr.oidtiers = tt.oid
			where enactivite = 1
				and tt.code like 'C%'
				and tr.catregion in ('RDRSOM','RDRONO','RDRNEA','RDRE' ,'RDRSANO','RDRSM','RDRYDE','RDRC','RDRDLA','RDRES')
				and tr.catregion = :Region
			order by tr.catregion " />

		<add key="Requete_List_Of_Fournisseurs" value="
			select
				tt.code,
				tt.raisonsociale as libelle
			from suite_financiere.ttiers tt
				join suite_financiere.troletiers tr on tr.oidtiers = tt.oid
			where enactivite = 1
				and (tt.code like 'F%') /* or tt.code like 'S%')*/
			order by 2 " />

		<add key="Requete_List_Of_Processus" value="
			select
				tp.code,
				tp.caption as libelle
			from suite_financiere.tpositionanalytique tp
				join suite_financiere.tdimensionanalytique td on tp.oiddimensionanalytique = td.oid
			where td.code = 'PROCESSUS' and (tp.code like 'C0%' or tp.code like 'B0%')
			order by 2 " />

		<add key="Requete_List_Of_Localisation" value="
			select
				tp.code,
				tp.caption as libelle
			from suite_financiere.tpositionanalytique tp
				join suite_financiere.tdimensionanalytique td on tp.oiddimensionanalytique = td.oid
			where td.code = 'LOCALISATION'
			order by 2 " />

		<add key="Requete_List_Of_Projet" value="
			select
				tp.code,
				tp.caption as libelle
			from suite_financiere.tpositionanalytique tp
				join suite_financiere.tdimensionanalytique td on tp.oiddimensionanalytique = td.oid
			where td.code = 'PROJET'
			order by 2 " />

		<!--add key="Requete_Code_Budget_Requestor" value="
			select distinct
				s.code,
				t.code caption
			from suite_financiere.tpersonne t
				join suite_financiere.tservice s on t.oidservice = s.oid
			where trim(t.code) is not null and lower(t.code) = :Login_Outlook " /-->
			
		<add key="Requete_Code_Budget_Requestor" value="
			select distinct
				s.code code_budgetaire,
				n.code,
				b.code poste_budgetaire,
				b.caption
			from suite_financiere.tposte b
				join suite_financiere.tnaturevalidationdemandeur n on b.oidcategoriedemandeur = n.oid
				join suite_financiere.tpersonne t on n.oid = t.oidnaturevalidationdemandeur
				join suite_financiere.tservice s on t.oidservice = s.oid
			where t.code = :Login_Outlook " />

      <add key="Requete_Demandes_Engagements" value="
		select
			te.numero,
			td.montantvalorisation_tcvalue montant,
			te.datecreation,
			tp.nom || ' ' || tp.prenom nomRequestor,
			tt.code codeFournisseur,
			tt.raisonsociale nomFournisseur,
			tn.code codeLibelle,
			tn.caption libelle
		from suite_financiere.tdemandeengagement te
			join suite_financiere.tdetailengagement td on te.oid = td.oiddemandeengagement
			join suite_financiere.tpersonne tp on te.oiddemandeur = tp.oid
			join suite_financiere.troletiers tr on td.oidfournisseur = tr.oid
			join suite_financiere.ttiers tt on tr.oidtiers = tt.oid
			join suite_financiere.tservice ts on te.oidservice = ts.oid
			join suite_financiere.tnaturevalidationdemandeur tn on ts.oidnaturevalidationdemandeur = tn.oid
		where tn.code in ('G84390','G84320','G84380','G843F0','G843C0','G84350','G843D0','G843B0','G84370')
			and tt.code = :Code_Fournisseur
			and te.datecreation >= to_date(:Date_Debut, 'dd/mm/yyyy')
			and te.datecreation &lt;= to_date(:Date_Fin, 'dd/mm/yyyy') " />

      <add key="Requete_Bons_De_Commandes" value="
		select
	        tpieceachat.nopiece numerobc,
	        tpieceachat.datepiece datebc,
	        tpieceachatetablissementro.code codefournisseur,
	        roletiersrotiers.raisonsociale nomfournisseur,
	        detaillivraisonlist.quantite * contratcommdetaillist.prixnet as montantarticle,
	        tpieceachat.totalht_tcvalue montantbc,
	        t3.designationproduit nomarticle,
	        suite_financiere.tservice.catregion region
        from
	        suite_financiere.tpiecetaxable tpieceachat
	        left outer join suite_financiere.tdetailtaxable contratcommdetaillist on contratcommdetaillist.oidcontratcommercial=tpieceachat.oid
	        left outer join suite_financiere.tdetaillivraison detaillivraisonlist on detaillivraisonlist.oidcontratcommercialdetail=contratcommdetaillist.oid
	        left outer join suite_financiere.tpositionanalytique t1 on t1.oid=contratcommdetaillist.oiddpositionanalytique
	        left outer join suite_financiere.tproduitcommercial tproduitcommercial on contratcommdetaillist.oidproduitcommercial = tproduitcommercial.oid
	        left outer join suite_financiere.troletiers roletiersro on tpieceachat.oidroletiersro = roletiersro.oid
	        left outer join suite_financiere.tsitecommerciale tdepot on detaillivraisonlist.oiddepot = tdepot.oid
	        left outer join suite_financiere.ttiers roletiersrotiers on roletiersro.oidtiers = roletiersrotiers.oid
	        left outer join suite_financiere.tdbfcurrency tpieceachatdevise on tpieceachat.oiddevise = tpieceachatdevise.oid
	        left outer join suite_financiere.tpersonne tpieceachatoperateur on tpieceachat.oidoperateur = tpieceachatoperateur.oid
	        left outer join suite_financiere.tsite tpieceachatetablissementro on tpieceachat.oidetablissementro = tpieceachatetablissementro.oid
	        left outer join suite_financiere.tsitecommerciale tpieceachatadresselivraison on tpieceachat.oidadresselivraison = tpieceachatadresselivraison.oid
	        left outer join suite_financiere.tsite tpieceachatetablissementdo on tpieceachat.oidetablissementdo = tpieceachatetablissementdo.oid
	        left outer join suite_financiere.tpositionanalytique t2 on contratcommdetaillist.oidppositionanalytique = t2.oid
	        left outer join suite_financiere.tproduitcommercial t0 on contratcommdetaillist.oidproduitcommercial = t0.oid
	        left outer join suite_financiere.tdetailtaxable t3 on detaillivraisonlist.oidcontratcommercialdetail = t3.oid
	        left outer join suite_financiere.tproduit t5 on t0.oidproduit = t5.oid
	        left outer join suite_financiere.tequivalenceuniteproduit t4 on t5.oidequivalenceuniteproduit = t4.oid
	        left outer join suite_financiere.tservice on tpieceachat.oidservice =suite_financiere.tservice.oid
        where tpieceachat.idotp = 460
	        and regexp_replace(tpieceachat.nopiece, '^.CF>') = :Code_BonCommande
	        and tpieceachatetablissementro.code = :Code_Fournisseur
        order by 1,3,7 " />

      <add key="Requete_Verification_Infos" value="
		select
			  devis.nopiece as numero_devis
			, devis.datepiece as date_devis
			, tiersdo.code as code_tiersdo
			, tiersdo.raisonsociale as libelle_tiersdo
			, devis.referencepiece as numero_dm
			, devis.numerooscms as numero_os
			, fournisseur_salarie.code as code_fournissuer
			, fournisseur_salarie.raisonsociale as libelle_fournisseur
			, produit.code as code_produit
			, produit.caption as libelle_produit
			, ddv.quantitenegociee as quantite
			, ddv.montantnet_tcvalue
			, destination.code as destination
			, projet.code as projet
			, processus.code as processus
			, ' ' as commentaire
		from suite_financiere.tpiecetaxable devis
			join suite_financiere.tdetailtaxable ddv on ((devis.oid = ddv.oiddevisorigine) or (devis.oid = ddv.oidcontratcommercial))
			join suite_financiere.troletiers roletiersdo on devis.oidroletiersdo = roletiersdo.oid
			join suite_financiere.ttiers tiersdo on roletiersdo.oidtiers = tiersdo.oid
			join suite_financiere.ttiers fournisseur_salarie on devis.oidtiers = fournisseur_salarie.oid
			join suite_financiere.tpositionanalytique destination on devis.oiddpositionanalytique = destination.oid
			join suite_financiere.tpositionanalytique processus on ddv.oidspositionanalytique = processus.oid
			join suite_financiere.tpositionanalytique projet on ddv.oidppositionanalytique = projet.oid
			join suite_financiere.tproduitcommercial produit on produit.oid = ddv.oidproduitcommercial
		where devis.typeintervention = 3
			and devis.nopiece_countername = 'DV'
			/*--Parametres date importation
			--and devis.datepiece between to_date(:Date_Debut, 'dd/mm/yyyy') and to_date(:Date_Fin, 'dd/mm/yyyy')
			-- Parametre N° DM */
			and devis.referencepiece = :Reference_Piece
			/*--Parametre N° OS */
			and devis.numerooscms = :Numero_OS_CMS "/>

      <add key="Requete_Check_Liste_Materiels" value="
		select distinct
			*
		from (
		select distinct
			  t.numero_devis
			, t.date_devis
			, t.code_tiersdo
			, t.libelle_tiersdo
			, t.numero_dm
			, t.numero_os
			, t.code_fournissuer
			, t.libelle_fournisseur
			, nvl(t.code_produit, ' ') code_produit
			, t.libelle_produit
			, t.quantite
			, t.montantnet_tcvalue
			, t.destination
			, t.projet
			, t.processus
			, (case
					when trim(m.codeMateriel) is not null and m.quantite != t.quantite
						then 'QUANTITE NON CONCORDANTE'
					when trim(m.codeMateriel) is null
						then 'MATERIEL NON AUTORISE'
			  end) commentaire
		from materiels_to_check m
			full outer join (
				select
					  devis.nopiece as numero_devis
					, devis.datepiece as date_devis
					, tiersdo.code as code_tiersdo
					, tiersdo.raisonsociale as libelle_tiersdo
					, devis.referencepiece as numero_dm
					, devis.numerooscms as numero_os
					, fournisseur_salarie.code as code_fournissuer
					, fournisseur_salarie.raisonsociale as libelle_fournisseur
					, produit.code as code_produit
					, produit.caption as libelle_produit
					, ddv.quantitenegociee as quantite
					, ddv.montantnet_tcvalue
					, destination.code as destination
					, projet.code as projet
					, processus.code as processus
				from suite_financiere.tpiecetaxable devis
					join suite_financiere.tdetailtaxable ddv on ((devis.oid = ddv.oiddevisorigine) or (devis.oid = ddv.oidcontratcommercial))
					join suite_financiere.troletiers roletiersdo on devis.oidroletiersdo = roletiersdo.oid
					join suite_financiere.ttiers tiersdo on roletiersdo.oidtiers = tiersdo.oid
					join suite_financiere.ttiers fournisseur_salarie on devis.oidtiers = fournisseur_salarie.oid
					join suite_financiere.tpositionanalytique destination on devis.oiddpositionanalytique = destination.oid
					join suite_financiere.tpositionanalytique processus on ddv.oidspositionanalytique = processus.oid
					join suite_financiere.tpositionanalytique projet on ddv.oidppositionanalytique = projet.oid
					join suite_financiere.tproduitcommercial produit on produit.oid = ddv.oidproduitcommercial
				where devis.typeintervention = 3
					and devis.nopiece_countername = 'DV'
					/*--Parametre N° OS */
					and devis.numerooscms = :Numero_OS_CMS
			) t on m.codeMateriel = t.code_produit
		) where trim(commentaire) is not null " />

	    <add key="Requete_PostesDefenses_Infos" value="
			select
				p.code code_budget,
				ng.code type_budget,
				p.caption libelle_Poste_Depense,
				sum(ebp.montant) as montant_budgete
			from suite_financiere.thypothesebudgetaire hb,
				suite_financiere.telementbudgetexercice ebe,
				suite_financiere.tposte p,
				suite_financiere.telementbudgetperiode ebp,
				suite_financiere.tnaturebudgetaire ng
			where hb.oid = ebe.oidhypothesebudgetaire
				and  ebe.oidpostebudgetaire = p.oid
				and ebe.oid = ebp.oidelementbudgetexercice
				and p.oidnaturebudgetaire = ng.oid
				and (upper(hb.caption) like '%BUDGET%' and hb.caption like '%' || to_char(sysdate,'yyyy') || '%')
				and ng.code = :Type_Budget
				and p.code = :Code_Budget
			group by p.code, p.caption, ng.code " />

      <add key="Requete_Contrat_Infos" value="
	    with tb_moyenne as (
				select distinct
					num_sum,
					id_apa,
					max(num_rue) over(partition by num_sum,id_apa) Nombre_de_roue,
					avg(case when desc_tip_csmo = 'MOYENNE_DE_CSMO' then csmo end) over(partition by num_sum,id_apa) Moyenne_de_csmo,
					avg(case when desc_tip_csmo = 'MOYENNE_DE_REACT' then csmo end) over(partition by num_sum,id_apa) Moyenne_de_React,
					avg(case when desc_tip_csmo = 'MOYENNE_DE_DEMAND' then csmo end) over(partition by num_sum,id_apa) Moyenne_de_Demand
				from (
				select
					a.num_sum,
					id_apa,
					csmo,
					num_rue,
					(case
						when tip_csmo in (select tip_csmo from cmsadmin.csmo_bloque where tip_csmo_bloque in ('CO900', 'CO903'))
							then 'MOYENNE_DE_CSMO'
						when tip_csmo in (select tip_csmo from cmsadmin.csmo_bloque where tip_csmo_bloque in ('CO905'))
							then 'MOYENNE_DE_REACT'
						when tip_csmo in (select tip_csmo from cmsadmin.csmo_bloque where tip_csmo_bloque in ('CO916'))
							then 'MOYENNE_DE_DEMAND'
					end) desc_tip_csmo
				from cmsadmin.apmedida_co a join cmsadmin.sumcon s on a.num_sum = s.num_sum
				where est_csmo = 'US001' and tip_lect = 'RA005' and s.nis_rad = :Numero_Contrat
				)),
				tb_xclientes as (
				select distinct
					nis_rad,
					max(doc_id) keep(dense_rank last order by doc_id) over(partition by nis_rad) doc_id,
					max(nom_padre) keep(dense_rank last order by doc_id) over(partition by nis_rad) nom_padre
				from cmsadmin.xclientes)
				/*,tb_clients_gc as (
				select distinct
					'REGRION GC' region,
					'DEPARTMT GC' department,
					'AGENCE GC' Agence,
					service_no,
					'CLIENT_GC' type_client
				from cmsreport.sdgc_groupes) */
				select distinct
				/*--	Division commerciale */
				/*--	nvl2(tcg.service_no, tcg.region, bs.nom_area) region, */
					bs.nom_area region,
				/*--	Région */
				/*--	nvl2(tcg.service_no, tcg.department, bs.nom_zona) department, */
					bs.nom_zona department,
				/*--	Agence */
				/*--	nvl2(tcg.service_no, tcg.Agence, bs.nom_unicom) Agence, */
					bs.nom_unicom Agence,
					bs.cod_unicom Code_Agence,
				/*--	N° Contrat */
					s.nis_rad No_Contract,
					s.num_sum No_Supply,
					cl.cod_cli No_Client,
					s.cod_cta No_Account,
					s.nif Premise_No,
					s.usr_varchar1 Geo_Ref,
					s.imp_derechos_conex_pagado Cont_Balance,
				/*--	Nom client */
					RTRIM (cl.ape1_cli)|| ' '|| LTRIM (cl.ape2_cli || ' ' || cl.nom_cli) Nom_Client,
					'[ '||cl.TFNO1_CLI||'] - [ '||cl.TFNO2_CLI||'] - [ '||cl.TFNO3_CLI||' ]' CLIENT_TEL,
				/*--	Numéro regroupement */
					tx.doc_id No_Regroup,
					tx.nom_padre Nom_Regroup,
				/*--	Type de contrat ( Service Type) */
					s.tip_contr Cont_Category,
					tipo(s.tip_contr) Cont_Category_Desc,
					s.est_serv Cont_Status,
					estado(s.est_serv) Cont_Status_Desc,
					s.cod_tar Cont_Tariff,
					cmsreport.tariff(s.cod_tar) Cont_Tariff_Desc,
					s.gr_concepto Tariff_Group,
					(select tg.desc_gr
					from tar_grupo tg
					where tg.gr_concepto = s.gr_concepto and tg.cod_tar = s.cod_tar) Tariff_Group_Desc,

					(select desc_cnae from cmsadmin.cnae cb where cb.cod_cnae = s.cod_cnae) Economic_Activity,

					codigo(s.co_an_vip) Client_Priority,
					s.f_alta Cont_Start_date,
					s.f_baja_Serv Cont_End_Date,
				/*---- Supply Characteristics */
					su.pot_max_admis Max_Authorised_Power,
					tipo(su.tip_tension) Supply_Voltage,
					tipo(su.tip_fase) Supply_Phase,
					tipo(su.tip_suministro) Supply_type,
					su.usr_number2 Metering_side, -- Meter side 1 -> MT/BT 2 -> MT/MT
					estado(su.est_sum) Supply_Status,
				/*---- Premise */
					f.acc_finca Premise_ref,
					f.ref_dir Premise_access,
				/*---- Meter --> Numéro Compteur */
					max(ap.num_apa) keep(dense_rank last order by ap.f_inst) over(partition by s.num_sum) No_Compteur,
					codigo(max(ap.co_marca) keep(dense_rank last order by ap.f_inst) over(partition by s.num_sum)) Model_Compteur,
				/*--	Nombre de roue */
					tm.Nombre_de_roue,
				/*--	Moyenne de consommation */
					trunc(tm.Moyenne_de_csmo) Moyenne_de_csmo,
				/*--	Moyenne de reactive */
					trunc(tm.Moyenne_de_React) Moyenne_de_React,
				/*--	Moyenne de demand */
					trunc(tm.Moyenne_de_Demand) Moyenne_de_Demand
				from cmsadmin.sumcon s
					join cmsadmin.cuentas_cu cu on s.cod_cta = cu.cod_cta
					join cmsadmin.clientes cl on cu.cod_cli = cl.cod_cli
					join cmsadmin.fincas f on f.nif = s.nif
					left join cmsadmin.suministros su on s.num_sum = su.num_sum
					left join cmsadmin.apmedida_ap ap on s.num_sum = ap.num_sum
					left join cmsadmin.business_struct bs on s.cod_unicom = bs.cod_unicom
					left join tb_moyenne tm on s.num_sum = tm.num_sum and ap.id_apa = tm.id_apa
					left join tb_xclientes tx on s.nis_rad = tx.nis_rad
					/*left join tb_clients_gc tcg on s.nis_rad = tcg.service_no*/
				where s.nis_rad = :Numero_Contrat " />

    <add key="Requete_Reclamation_Infos" value="
	  select
				/*--	Division commerciale */
					bs.nom_area region,
				/*--	Région */
					bs.nom_zona department,
				/*--	Agence */
					bs.nom_unicom Agence,
					bs.cod_unicom Code_Agence,
				/*--	N° réclamation */
					tr.num_re No_Reclam,
				/*--	N° Facture contestée */
					tr.num_rec_rcm No_Fact_Contestee,
				/*--	Statut de Facture */
					NVL(estado(Dr.est_rec), 'NONE') Stat_Fact_Contestee,
				/*--	N° Contrat */
					tr.nis_rad No_Contract,
				/*--	N° Point de Livraison */
					tr.num_sum Supply_No,
				/*--	N° Ordre de Service */
					tr.num_os Service_Order_No,
				/*--	Type de contrat ( Service Type) */
					nvl(tipo(s.tip_contr), 'NONE') Cont_Category,
					nvl(estado(s.est_serv), 'NONE') Cont_Status,
					nvl(cmsreport.tariff(s.cod_tar), 'NONE') Cont_Tariff,
				/*--	Date réclamation */
					to_char(f_ire, 'dd/mm/yyyy') Dte_Reclam,
				/*--	Date resolution */
					to_char(f_uce, 'dd/mm/yyyy') Dte_Resol,
				/*--	Prénom client */
					RTRIM (cl.ape1_cli) Prenom_Client,
				/*--	Nom client */
					RTRIM (cl.ape1_cli)|| ' '|| LTRIM (cl.ape2_cli || ' ' || cl.nom_cli) Nom_Client,
				/*--	Complaint Type */
					tipo(tip_rcm) Complaint_Type,
				/*--	Raison */
					codigo(Mot_rcm) Raison_Recl,
					codigo(Co_med_rcm) Complaint_Means,
				/*--	Statut réclamation */
					estado(est_rcm) Statut_Recl,
				/*--	Nom initiateur réclamation et matricule */
					tr.usuario || ' - ' || cmsreport.usuario(tr.usuario) User_Init_Name,
				/*--	Tout autre champs utile. */
					to_char(f_act, 'dd/mm/yyyy') Der_Activity_Dte,
					tipo(tip_act) Der_Type_Activity,
					desc_act Der_Activity_Desc,
				/*--	user last update */
					da.usuario || ' - ' || cmsreport.usuario(da.usuario) Der_Activity_User
				from cmsadmin.trabpend_re tr
					join cmsadmin.datos_act da on tr.num_re = da.num_re and tr.num_act_gen = da.num_act
					left join cmsadmin.clientes cl on tr.cod_cli = cl.cod_cli
					left join cmsadmin.datos_recl dr on tr.num_re = dr.num_re and tr.num_rec_rcm = dr.num_rec and tr.nis_rad = dr.nis_rad and tr.num_sum = dr.num_sum
					left join cmsadmin.business_struct bs on tr.cod_unicom = bs.cod_unicom
					left join cmsadmin.sumcon s on tr.nis_rad = s.nis_rad
				where tr.tip_rcm = 'ZO012'  /* Concerns oly the complaint type ==> ZO012 == BILL COMPLAINT -- Open filter for the others cases */
					and tr.num_re = :Numero_Reclamation " />

    <add key="Requete_Reclamations_Of_Contrat" value="
	  select
		/*--	Division commerciale */
			bs.nom_area region,
		/*--	Région */
			bs.nom_zona department,
		/*--	Agence */
			bs.nom_unicom Agence,
			bs.cod_unicom Code_Agence,
		/*--	N° réclamation */
			tr.num_re No_Reclam,
		/*--	N° Facture contestée */
			tr.num_rec_rcm No_Fact_Contestee,
		/*--	Statut de Facture */
			NVL(estado(Dr.est_rec), 'NONE') Stat_Fact_Contestee,
		/*--	N° Contrat */
			tr.nis_rad No_Contract,
		/*--	N° Point de Livraison */
			tr.num_sum Supply_No,
		/*--	N° Ordre de Service */
			tr.num_os Service_Order_No,
		/*--	Type de contrat ( Service Type) */
			nvl(tipo(s.tip_contr), 'NONE') Cont_Category,
			nvl(estado(s.est_serv), 'NONE') Cont_Status,
			nvl(cmsreport.tariff(s.cod_tar), 'NONE') Cont_Tariff,
		/*--	Date réclamation */
			to_char(f_ire, 'dd/mm/yyyy') Dte_Reclam,
		/*--	Date resolution */
			to_char(f_uce, 'dd/mm/yyyy') Dte_Resol,
		/*--	Prénom client */
			RTRIM (cl.ape1_cli) Prenom_Client,
		/*--	Nom client */
			RTRIM (cl.ape1_cli)|| ' '|| LTRIM (cl.ape2_cli || ' ' || cl.nom_cli) Nom_Client,
		/*--	Complaint Type */
			tipo(tip_rcm) Complaint_Type,
		/*--	Raison */
			codigo(Mot_rcm) Raison_Recl,
			codigo(Co_med_rcm) Complaint_Means,
		/*--	Statut réclamation */
			estado(est_rcm) Statut_Recl,
		/*--	Nom initiateur réclamation et matricule */
			tr.usuario || ' - ' || cmsreport.usuario(tr.usuario) User_Init_Name,
		/*--	Tout autre champs utile. */
			to_char(f_act, 'dd/mm/yyyy') Der_Activity_Dte,
			tipo(tip_act) Der_Type_Activity,
			desc_act Der_Activity_Desc,
		/*--	user last update */
			da.usuario || ' - ' || cmsreport.usuario(da.usuario) Der_Activity_User
		from cmsadmin.trabpend_re tr
			join cmsadmin.datos_act da on tr.num_re = da.num_re and tr.num_act_gen = da.num_act
			left join cmsadmin.clientes cl on tr.cod_cli = cl.cod_cli
			left join cmsadmin.datos_recl dr on tr.num_re = dr.num_re and tr.num_rec_rcm = dr.num_rec and tr.nis_rad = dr.nis_rad and tr.num_sum = dr.num_sum
			left join cmsadmin.business_struct bs on tr.cod_unicom = bs.cod_unicom
			left join cmsadmin.sumcon s on tr.nis_rad = s.nis_rad
		where tr.tip_rcm = 'ZO012'  /* Concerns oly the complaint type ==> ZO012 :: BILL COMPLAINT -- Open filter for the others cases */
			and tr.nis_rad = :Numero_Contrat " />

      <add key="Requete_ServiceOrder_Infos" value="
		  select
			  /*--	Division commerciale */
				  bs.nom_area region,
			  /*--	Région */
				  bs.nom_zona department,
			  /*--	Agence */
				  bs.nom_unicom Agence,
				  bs.cod_unicom Code_Agence,
				  o.nis_rad,
				  o.num_sum,
				  decode(o.num_sum, 0, o.comment_os) W_Request_No,
			  /*--	Numéro OS */
				  o.num_os Order_No,
			  /*--	Date OS */
				  to_char(o.f_gen, 'dd/mm/yyyy') Date_Gen_OS,
				  o.cod_unicom Hub_Tech_Resp_Code,
				 cmsreport.unicom_all(o.cod_unicom) Hub_Tech_Resp,
			  /*--	Nom du technicien */
				  decode(num_sum, 0,
					  (select distinct nom_ctrat from cmsadmin.contratas c, cmsadmin.so_assignment so where so.num_os = o.num_os and c.cod_ctrat = so.cod_ctrat),
					  (select distinct nom_ctrat from cmsadmin.contratas c where c.cod_ctrat = o.cod_ctrat)) Nom_Contractor,
			  /*--	Nom initiateur OS */
				  decode(cod_emp_gen, 0,
					  cmsreport.usuario((select usuario
								  from (select e.usuario, sec_est_os, row_number() over (partition by e.num_os order by f_actual asc) row_num
									  from est_os e
									  where e.num_os = o.num_os and e.est_os = 'EO001')
								  where row_num = 1 )),
					  (select rtrim (p.ape1_emp)|| ' '|| ltrim (p.ape2_emp || ' ' || p.nom_emp) from personal p where p.cod_emp = o.cod_emp_gen)) Nom_Gen_OS,
				  decode(sign(cod_emp_asig), -1,
					  (select rtrim (p.ape1_emp)|| ' '|| ltrim (p.ape2_emp || ' ' || p.nom_emp) from personal p where p.cod_emp = o.cod_emp_asig)) Nom_Assign_OS,
			  /*--	Visit */
				  to_char(trunc(f_vis), 'dd/mm/yyyy') Visit_Date,
				  codigo(co_acceje) Visit_Type,
				  (select rtrim (p.ape1_emp)|| ' '|| ltrim (p.ape2_emp || ' ' || p.nom_emp) from personal p where p.cod_emp = v.cod_emp ) Visit_Technician,
				  to_char(v.observaciones || '') Visit_comments,
			  /*--	Last user update on order */
				  cmsreport.usuario((select usuario
							  from (select e.usuario, sec_est_os, row_number() over (partition by e.num_os order by f_actual desc) row_num
									  from est_os e where e.num_os = o.num_os)
							  where row_num = 1)) Nom_Last_Update_OS,
			  /*--	Statut OS */
				  estado(est_os) Statut_OS,
				  (select to_char(f_inc_est,'dd/mm/yyyy') f_inc_est
					  from (select e.f_inc_est, sec_est_os, row_number() over (partition by e.num_os order by f_actual desc) row_num
							  from est_os e where e.num_os = o.num_os)
					  where row_num = 1 ) Statut_date,
			  /*--	Toutes les autres informations utiles */
				  o.co_sistgen ORIGIN_CODE,
				  codigo(o.co_sistgen) ORIGEN_DESC,
				  o.tip_os Order_Code,
				  tipo(o.tip_os) Order_Type,
				  to_char(comment_os || '') comment_os,
			  /*--	Premise */
				  f.acc_finca Premise_ref,
				  f.ref_dir Premise_access
			  from cmsadmin.ordenes o, cmsadmin.visita v, cmsadmin.fincas f, cmsadmin.business_struct bs
			  where o.num_os = v.num_os(+)
				  and bs.cod_unicom = decode(o.num_sum, 0,
												  (select distinct eb.cod_unicom_compet from cmsadmin.expedientes eb where eb.num_exp = o.comment_os),
												  (select distinct su.cod_unicom from cmsadmin.suministros su where su.num_sum = o.num_sum))
				  and f.nif = decode(o.num_sum, 0,
										  (select distinct fe.nif from cmsadmin.expedientes eb, cmsadmin.fincas_exp fe where eb.num_exp = fe.num_exp and eb.num_exp = o.comment_os),
										  (select distinct su.nif from cmsadmin.suministros su where su.num_sum = o.num_sum))
				  and o.num_os = :Numero_SO "/>

      <add key="Requete_ServicesOrders_Of_Contrat" value="
		  select
			  /*--	Division commerciale */
				  bs.nom_area region,
			  /*--	Région */
				  bs.nom_zona department,
			  /*--	Agence */
				  bs.nom_unicom Agence,
				  bs.cod_unicom Code_Agence,
				  o.nis_rad,
				  o.num_sum,
				  decode(o.num_sum, 0, o.comment_os) W_Request_No,
			  /*--	Numéro OS */
				  o.num_os Order_No,
			  /*--	Date OS */
				  to_char(o.f_gen, 'dd/mm/yyyy') Date_Gen_OS,
				  o.cod_unicom Hub_Tech_Resp_Code,
				 cmsreport.unicom_all(o.cod_unicom) Hub_Tech_Resp,
			  /*--	Nom du technicien */
				  decode(num_sum, 0,
					  (select distinct nom_ctrat from cmsadmin.contratas c, cmsadmin.so_assignment so where so.num_os = o.num_os and c.cod_ctrat = so.cod_ctrat),
					  (select distinct nom_ctrat from cmsadmin.contratas c where c.cod_ctrat = o.cod_ctrat)) Nom_Contractor,
			  /*--	Nom initiateur OS */
				  decode(cod_emp_gen, 0,
					  cmsreport.usuario((select usuario
								  from (select e.usuario, sec_est_os, row_number() over (partition by e.num_os order by f_actual asc) row_num
									  from cmsadmin.est_os e
									  where e.num_os = o.num_os and e.est_os = 'EO001')
								  where row_num = 1 )),
					  (select rtrim (p.ape1_emp)|| ' '|| ltrim (p.ape2_emp || ' ' || p.nom_emp) from cmsadmin.personal p where p.cod_emp = o.cod_emp_gen)) Nom_Gen_OS,
				  decode(sign(cod_emp_asig), -1,
					  (select rtrim (p.ape1_emp)|| ' '|| ltrim (p.ape2_emp || ' ' || p.nom_emp) from cmsadmin.personal p where p.cod_emp = o.cod_emp_asig)) Nom_Assign_OS,
			  /*--	Visit */
				  to_char(trunc(f_vis), 'dd/mm/yyyy') Visit_Date,
				  codigo(co_acceje) Visit_Type,
				  (select rtrim (p.ape1_emp)|| ' '|| ltrim (p.ape2_emp || ' ' || p.nom_emp) from cmsadmin.personal p where p.cod_emp = v.cod_emp ) Visit_Technician,
				  to_char(v.observaciones || '') Visit_comments,
			  /*--	Last user update on order */
				 cmsreport.usuario((select usuario
							  from (select e.usuario, sec_est_os, row_number() over (partition by e.num_os order by f_actual desc) row_num
									  from cmsadmin.est_os e where e.num_os = o.num_os)
							  where row_num = 1)) Nom_Last_Update_OS,
			  /*--	Statut OS */
				  estado(est_os) Statut_OS,
				  (select to_char(f_inc_est,'dd/mm/yyyy') f_inc_est
					  from (select e.f_inc_est, sec_est_os, row_number() over (partition by e.num_os order by f_actual desc) row_num
							  from cmsadmin.est_os e where e.num_os = o.num_os)
					  where row_num = 1 ) Statut_date,
			  /*--	Toutes les autres informations utiles */
				  o.co_sistgen ORIGIN_CODE,
				  codigo(o.co_sistgen) ORIGEN_DESC,
				  o.tip_os Order_Code,
				  tipo(o.tip_os) Order_Type,
				  to_char(comment_os || '') comment_os,
			  /*--	Premise */
				  f.acc_finca Premise_ref,
				  f.ref_dir Premise_access
			  from cmsadmin.ordenes o, cmsadmin.visita v, cmsadmin.fincas f, cmsadmin.business_struct bs
			  where o.num_os = v.num_os(+)
				  and bs.cod_unicom = decode(o.num_sum, 0,
												  (select distinct eb.cod_unicom_compet from cmsadmin.expedientes eb where eb.num_exp = o.comment_os),
												  (select distinct su.cod_unicom from cmsadmin.suministros su where su.num_sum = o.num_sum))
				  and f.nif = decode(o.num_sum, 0,
										  (select distinct fe.nif from cmsadmin.expedientes eb, cmsadmin.fincas_exp fe where eb.num_exp = fe.num_exp and eb.num_exp = o.comment_os),
										  (select distinct su.nif from cmsadmin.suministros su where su.num_sum = o.num_sum))
				  and o.nis_rad = :Numero_Contrat "/>

      <add key="Requete_Bill_Infos" value="
        select distinct
        /*--	Division commerciale */
	        bs.nom_area region,
        /*--	Région */
	        bs.nom_zona department,
        /*--	Agence */
	        bs.nom_unicom Agence,
	        bs.cod_unicom Code_Agence,
        /*--	N° Contrat */
	        s.nis_rad No_Contract,
	        s.num_sum No_Supply,
	        cl.cod_cli No_Client,
	        s.cod_cta No_Account,
	        s.nif Premise_No,
	        s.usr_varchar1 Geo_Ref,
	        S.imp_derechos_conex_pagado Cont_Balance,
        /*--	Nom client */
	        rtrim (cl.ape1_cli)|| ' '|| ltrim (cl.ape2_cli || ' ' || cl.nom_cli) Nom_Client,
	        '[ '||cl.tfno1_cli||'] - [ '||cl.tfno2_cli||'] - [ '||cl.tfno3_cli||' ]' CLIENT_TEL,
        /*--	Numéro regroupement */
	        (select doc_id
	        from cmsadmin.xclientes x
	        where x.nis_rad = s.nis_rad
	        and rownum = 1) No_Regroup,

	        (select nom_padre
	        from cmsadmin.xclientes x
	        where x.nis_rad = s.nis_rad
	        and rownum = 1) Nom_Regroup,
        /*--	Type de contrat ( Service Type) */
	        s.tip_contr Cont_Category,
	        tipo(s.tip_contr) Cont_Category_Desc,
	        s.est_serv Cont_Status,
	        estado(s.est_serv) Cont_Status_Desc,
	        s.cod_tar Cont_Tariff,
	       cmsreport.tariff(s.cod_tar) Cont_Tariff_Desc,
	        s.gr_concepto Tariff_Group,
	        (select tg.desc_gr
	        from cmsadmin.tar_grupo tg
	        where tg.gr_concepto = s.gr_concepto and tg.cod_tar = s.cod_tar) Tariff_Group_Desc,
	        (select desc_cnae from cmsadmin.cnae cb where cb.cod_cnae = s.COD_CNAE) Economic_Activity,
	        codigo(s.CO_AN_VIP) Client_Priority,
	        /*-------------------- CONTRACT VALIDITY --------------------------- */
	        to_char(s.f_alta, 'dd/mm/yyyy') Cont_Start_date,
	        to_char(s.f_baja_Serv, 'dd/mm/yyyy') Cont_End_Date,
	        /*----------------------- BILL DETAILS ------------------------------ */
        /*--	Numéro facture */
	        r.num_rec No_Facture,
	        decode(ind_conversion, 1, 'MIGRE', 'CMS') CMS_FACTURE,
        /*--	Date facture */
	        to_char(r.f_fact, 'dd/mm/yyyy') Date_facture,
        /*--	Mois facturation */
        /*--	Change language accordingly Engliss to French or French to English */
	        to_number(to_char(r.f_fact, 'MM')) || ' - '||
	        to_char(r.f_fact, 'MON', 'nls_date_language=English') Mois_facturation,
        /*--	Période de facturation (Date début, Date Fin) */
	        to_char(r.f_fact_ant, 'dd/mm/yyyy') Date_debut,
	        to_char(r.f_fact, 'dd/mm/yyyy') Date_Fin,
        /*--	Number of days */
	        r.num_dias_fact No_de_Jours,
        /*--	Type of billing */
	        decode(r.ind_real_est, 1, 'ACTUAL', 'ESTIME') Type_Facturation,
        /*--	Ancien index */
	        nvl(aob.lect, 0) Ancien_index,
	        nvl(tipo(aob.tip_lect), ' ') Type_Ancien_index,
        /*--	Nouvel index */
	        nvl(ao.lect, 0) Nouvel_index,
	        nvl(tipo(ao.tip_lect), ' ') Type_Nouvel_index,
        /*--	Consommation */
	        nvl(hf.csmo_total_fact, 0) Consumation,
        /*--	Montant facture */
	        r.imp_tot_rec Montant_facture,
        /*--	Statut facture */
	        estado(r.est_act) Statut_Facture,
			nvl((lag(ao.lect,1, null) over(partition by r.nis_rad order by r.f_fact)), aob.lect) ancien_index_calcule
        from cmsadmin.recibos r
	        join cmsadmin.sumcon s on r.nis_rad = s.nis_rad
	        join cmsadmin.clientes cl on s.cod_cli = cl.cod_cli
	        left join cmsadmin.hfacturacion hf on r.num_rec = hf.num_rec and hf.ind_val_fact = 1
	        left join cmsadmin.apmedida_co ao on ao.num_sum = hf.num_sum and ao.f_lect = r.f_fact and ao.est_csmo = 'US001'
	        left join cmsadmin.apmedida_co aob on aob.num_sum = hf.num_sum and aob.f_lect = r.f_fact_ant and aob.est_csmo = 'US001'
	        left join cmsadmin.business_struct bs on s.cod_unicom = bs.cod_unicom
        where r.tip_rec = 'TR010'
 	        and r.est_act not in (select est_rec from cmsadmin.grupo_est where co_grupo like 'GE999')
 	        and r.num_rec = :Numero_Facture "/>

      <add key="Requete_BillS_Of_Contrats" value="
        select distinct
        /*--	Division commerciale */
	        bs.nom_area region,
        /*--	Région */
	        bs.nom_zona department,
        /*--	Agence */
	        bs.nom_unicom Agence,
	        bs.cod_unicom Code_Agence,
        /*--	N° Contrat */
	        s.nis_rad No_Contract,
	        s.num_sum No_Supply,
	        cl.cod_cli No_Client,
	        s.cod_cta No_Account,
	        s.nif Premise_No,
	        s.usr_varchar1 Geo_Ref,
	        S.imp_derechos_conex_pagado Cont_Balance,
        /*--	Nom client */
	        rtrim (cl.ape1_cli)|| ' '|| ltrim (cl.ape2_cli || ' ' || cl.nom_cli) Nom_Client,
	        '[ '||cl.tfno1_cli||'] - [ '||cl.tfno2_cli||'] - [ '||cl.tfno3_cli||' ]' CLIENT_TEL,
        /*--	Numéro regroupement */
	        (select doc_id
	        from cmsadmin.xclientes x
	        where x.nis_rad = s.nis_rad
	        and rownum = 1) No_Regroup,

	        (select nom_padre
	        from cmsadmin.xclientes x
	        where x.nis_rad = s.nis_rad
	        and rownum = 1) Nom_Regroup,
        /*--	Type de contrat ( Service Type) */
	        s.tip_contr Cont_Category,
	        tipo(s.tip_contr) Cont_Category_Desc,
	        s.est_serv Cont_Status,
	        estado(s.est_serv) Cont_Status_Desc,
	        s.cod_tar Cont_Tariff,
	        cmsreport.tariff(s.cod_tar) Cont_Tariff_Desc,
	        s.gr_concepto Tariff_Group,
	        (select tg.desc_gr
	        from cmsadmin.tar_grupo tg
	        where tg.gr_concepto = s.gr_concepto and tg.cod_tar = s.cod_tar) Tariff_Group_Desc,
	        (select desc_cnae from cmsadmin.cnae cb where cb.cod_cnae = s.COD_CNAE) Economic_Activity,
	        codigo(s.CO_AN_VIP) Client_Priority,
	        /*-------------------- CONTRACT VALIDITY --------------------------- */
	        to_char(s.f_alta, 'dd/mm/yyyy') Cont_Start_date,
	        to_char(s.f_baja_Serv, 'dd/mm/yyyy') Cont_End_Date,
	        /*----------------------- BILL DETAILS ------------------------------ */
        /*--	Numéro facture */
	        r.num_rec No_Facture,
	        decode(ind_conversion, 1, 'MIGRE', 'CMS') CMS_FACTURE,
        /*--	Date facture */
	        to_char(r.f_fact, 'dd/mm/yyyy') Date_facture,
        /*--	Mois facturation */
        /*--	Change language accordingly Engliss to French or French to English */
	        to_number(to_char(r.f_fact, 'MM')) || ' - '||
	        to_char(r.f_fact, 'MON', 'nls_date_language=English') Mois_facturation,
        /*--	Période de facturation (Date début, Date Fin) */
	        to_char(r.f_fact_ant, 'dd/mm/yyyy') Date_debut,
	        to_char(r.f_fact, 'dd/mm/yyyy') Date_Fin,
        /*--	Number of days */
	        r.num_dias_fact No_de_Jours,
        /*--	Type of billing */
	        decode(r.ind_real_est, 1, 'ACTUAL', 'ESTIME') Type_Facturation,
        /*--	Ancien index */
	        nvl(aob.lect, 0) Ancien_index,
	        nvl(tipo(aob.tip_lect), ' ') Type_Ancien_index,
        /*--	Nouvel index */
	        nvl(ao.lect, 0) Nouvel_index,
	        nvl(tipo(ao.tip_lect), ' ') Type_Nouvel_index,
        /*--	Consommation */
	        nvl(hf.csmo_total_fact, 0) Consumation,
        /*--	Montant facture */
	        r.imp_tot_rec Montant_facture,
        /*--	Statut facture */
	        estado(r.est_act) Statut_Facture,
			nvl((lag(ao.lect,1, null) over(partition by r.nis_rad order by r.f_fact)), aob.lect) ancien_index_calcule
        from cmsadmin.recibos r
	        join cmsadmin.sumcon s on r.nis_rad = s.nis_rad
	        join cmsadmin.clientes cl on s.cod_cli = cl.cod_cli
	        left join cmsadmin.hfacturacion hf on r.num_rec = hf.num_rec and hf.ind_val_fact = 1
	        left join cmsadmin.apmedida_co ao on ao.num_sum = hf.num_sum and ao.f_lect = r.f_fact and ao.est_csmo = 'US001'
	        left join cmsadmin.apmedida_co aob on aob.num_sum = hf.num_sum and aob.f_lect = r.f_fact_ant and aob.est_csmo = 'US001'
	        left join cmsadmin.business_struct bs on s.cod_unicom = bs.cod_unicom
        where r.tip_rec = 'TR010'
 	        and r.est_act not in (select est_rec from cmsadmin.grupo_est where co_grupo like 'GE999')
 	        and r.nis_rad = :Numero_Contrat
			and r.f_fact between to_date(:Date_Debut, 'dd/mm/yyyy') and to_date(:Date_Fin, 'dd/mm/yyyy')
		order by to_date(to_char(r.f_fact, 'dd/mm/yyyy'), 'dd/mm/yyyy')"/>
		
		<add key="Requete_Check_WorkRequest_Nber" value="
			select
				(case when trim(t.num_exp) is null then 'INVALIDE' else 'VALIDE' end) check_result
			from cmsreport.tb_penalites_data_calculatespc t
			where t.num_exp = :Numero_WorkRequest "/>
		
		<add key="Requete_Check_Estimate_Id_Nber" value="
			select
				(case when trim(t.estimate_id) is null then 'INVALIDE' else 'VALIDE' end) check_result
			from cmsreport.tb_penalites_data_calculatespc t
			where t.estimate_id = :Numero_EstimateId "/>
		
		<add key="Requete_WorkRequest_Infos" value="
			select
				region,
				division departement,
				agency agence,
				num_exp numero_work_request,
				customer_name nom_client,
				sp_nber numero_point_de_livraison,
				service_no numero_de_contrat,
				estado(code_statut) statut_contrat,
				meter_no numero_compteur,
				wr_date_paid date_paiement,
				last_receipt numero_recu,
				amount_paid montant_paye,
				real_excution_date date_execution,
				service_point_date date_creation_du_pl,
				zone,
				delai_arsel,
				temps_mis,
				montant_penalites
			from cmsreport.tb_penalites_data_calculatespc
			where /*moratorium = 'NO' and*/ montant_penalites > 0
				and num_exp = :Numero_Work_Request "/>
		
		<add key="Requete_Check_Contract_Nber" value="
			select distinct
				/*--	Division commerciale */
				bs.nom_area region,
				/*--	Région */
				bs.nom_zona department,
				/*--	Agence */
				bs.nom_unicom Agence,
				bs.cod_unicom Code_Agence,
				/*--	N° Contrat */
				s.nis_rad No_Contract,
				s.num_sum No_Supply,
				cl.cod_cli No_Client,
				s.cod_cta No_Account,
				s.nif Premise_No,
				/*--	Nom client */
				RTRIM (cl.ape1_cli)|| ' '|| LTRIM (cl.ape2_cli || ' ' || cl.nom_cli) Nom_Client,
				'[ '||trim(cl.TFNO1_CLI)||'] - [ '||trim(cl.TFNO2_CLI)||'] - [ '||trim(cl.TFNO3_CLI)||' ]' CLIENT_TEL,
				/*--	Type de contrat ( Service Type) */
				tipo(s.tip_contr) Cont_Category_Desc,
				estado(s.est_serv) Cont_Status_Desc,
				cmsreport.tariff(s.cod_tar) Cont_Tariff_Desc,
				(select tg.desc_gr
				from cmsadmin.tar_grupo tg
				where tg.gr_concepto = s.gr_concepto and tg.cod_tar = s.cod_tar) Tariff_Group_Desc,
				
				(select desc_cnae from cmsadmin.cnae cb where cb.cod_cnae = s.cod_cnae) Economic_Activity,
				
				codigo(s.co_an_vip) Client_Priority,
				to_char(s.f_alta, 'dd/mm/yyyy') Cont_Start_date,
				to_char(s.f_baja_Serv, 'dd/mm/yyyy') Cont_End_Date,
				/*---- Supply Characteristics */
				su.pot_max_admis Max_Authorised_Power,
				tipo(su.tip_tension) Supply_Voltage,
				tipo(su.tip_fase) Supply_Phase,
				tipo(su.tip_suministro) Supply_type,
				decode(su.usr_number2, 1, 'MT/BT', 2, 'MT/MT', 'N/A') Metering_side, -- Meter side 1 -> MT/BT 2 -> MT/MT
				estado(su.est_sum) Supply_Status,
				/*---- Premise */
				f.acc_finca Premise_ref,
				f.ref_dir Premise_access,
				/*---- Meter --> Numéro Compteur */
				max(ap.num_apa) keep(dense_rank last order by ap.f_inst) over(partition by s.num_sum) No_Compteur,
				decode(s.est_serv, 'EC012', 'ACTIF', 'EC013', 'ACTIF', 'EC014', 'ACTIF', 'EC028', 'ACTIF', 'INACTIF') check_result
			from cmsadmin.sumcon s
				join cmsadmin.cuentas_cu cu on s.cod_cta = cu.cod_cta
				join cmsadmin.clientes cl on cu.cod_cli = cl.cod_cli
				join cmsadmin.fincas f on f.nif = s.nif
				left join cmsadmin.suministros su on s.num_sum = su.num_sum
				left join cmsadmin.apmedida_ap ap on s.num_sum = ap.num_sum
				left join cmsadmin.business_struct bs on s.cod_unicom = bs.cod_unicom
			where s.nis_rad = :Numero_Contrat "/>
		
		<add key="Requete_Check_Supply_Point_Nber" value="
			select
				(case when s.num_sum is null then 'INCORRECTE' else 'CORRECTE' end) check_result
			from cmsadmin.sumcon s join cmsadmin.expedientes e on s.num_sum = e.num_sum
			where s.nis_rad = :Numero_Contrat and e.num_exp = :Numero_WorkRequest "/>
		
		<add key="Requete_Agences_CMS" value="
			select
			    nom_area region
			  , nom_zona division
			  , cod_unicom code_agence
			  , nom_unicom agence
			from cmsadmin.business_struct
			where nom_unicom like 'CSC%'
			and empresa_id = 100
			order by 1,2,3 "/>

</appSettings>

  <connectionStrings>
    <!--add name="ConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=10.241.107.44)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=CMSPROD.GLOBAL.AES.COM)));User Id=KPIRHEXTRACT;Password=KPI_2014;" /-->
    <!--add name="ConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=cmsprodpr)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=CMSPROD.GLOBAL.AES.COM)));User Id=KPIRHEXTRACT;Password=Ene0_KP1_23;" /-->
    <add name="ConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=cmsprodpr)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=CMSPROD.GLOBAL.AES.COM)));User Id=COMPORTAL;Password=Portal*2015;" />
    <!--add name="HrConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=eneo1oda-scan)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=META4)));User Id=ETRAVEL;Password=New2016_password;" /-->
    <!--add name="HrConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=10.241.132.6)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=META4)));User Id=ETRAVEL;Password=New2016_password;" /-->
    <add name="HrConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=10.221.0.211)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=META4Stdb)));User Id=ETRAVEL;Password=New2016_password" />
	<add name="CMSReportConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=cmsprodpr)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=CMSPROD.GLOBAL.AES.COM)));User Id=COMPORTAL;Password=Portal*2015;" />
    <!--add name="SageConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=10.250.90.88)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=SAGE)));User Id=DEMAT_001;Password=demat123;" /-->
    <!--add name="SageConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=ENEO1ODA-SCAN)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=SAGE)));User Id=DEMAT_001;Password=demat123;" /-->
    <!--add name="SageConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=10.221.0.217)(PORT=1525))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=SAGE)));User Id=DEMAT_001;Password=demat123;" /-->
    <add name="SageConnectionString" connectionString="Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=10.241.107.77)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=SAGESTDB)));User Id=DEMAT_001;Password=demat123;" />
  </connectionStrings>

	<system.serviceModel>
		<services>
			<service name="AciServices">
				<endpoint binding="webHttpBinding" contract="RestFullAci.AciServices" behaviorConfiguration="webHttp" />
			</service>
		</services>
		<behaviors>
			<endpointBehaviors>
				<behavior name="webHttp">
					<webHttp />
				</behavior>
			</endpointBehaviors>
		</behaviors>

		<serviceHostingEnvironment aspNetCompatibilityEnabled="true" />
	</system.serviceModel>

  <system.web>
    <webServices>
      <protocols>
        <add name="HttpGet" />
        <add name="HttpPost" />
      </protocols>
    </webServices>

    <compilation debug="false" />
	
	<sessionState timeout="30"></sessionState>

    <!--compilation debug="true" strict="false" explicit="true" />
	<customErrors mode="Off" /-->

    <!--
      The <authentication> section enables configuration 
      of the security authentication mode used by 
      ASP.NET to identify an incoming user. 
    -->
    <authentication mode="Windows" />
    <!--identity impersonate="true" /-->
    <!--
       The <customErrors> section enables configuration 
       of what to do if/when an unhandled error occurs 
       during the execution of a request. Specifically, 
       it enables developers to configure html error pages 
       to be displayed in place of a error stack trace.

       <customErrors mode="RemoteOnly" defaultRedirect="GenericErrorPage.htm">
         <error statusCode="403" redirect="NoAccess.htm" />
         <error statusCode="404" redirect="FileNotFound.htm" />
       </customErrors>
    -->
  </system.web>
    <system.webServer>
		<httpErrors existingResponse="PassThrough" errorMode="Detailed"></httpErrors>
		<asp scriptErrorSentToBrowser="true" />
    </system.webServer>
<system.diagnostics>
    <trace autoflush="true" />
    <sources>
        <source name="System.Web.Services.Asmx">
            <listeners>
                <add name="AsmxTraceFile" type="System.Diagnostics.TextWriterTraceListener" initializeData="local.log" traceOutputOptions="LogicalOperationStack, DateTime, Timestamp, ProcessId, ThreadId" />
            </listeners>
        </source>
    </sources>
    <switches>
        <add name="System.Web.Services.Asmx" value="Verbose" />
    </switches>
</system.diagnostics>

</configuration>
